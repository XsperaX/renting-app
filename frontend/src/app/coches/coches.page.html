<!-- CABECERA ---------------------------------------------------- -->
<ion-header>
  <ion-toolbar color="dark">

    <!-- BOTÓN VOLVER -->
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home" text="Volver"></ion-back-button>
    </ion-buttons>

    <ion-title>Coches disponibles</ion-title>

    <!-- Botón para añadir coche -->
    <ion-buttons slot="end">
      <ion-button (click)="abrirModal()">
        <ion-icon name="add-circle"></ion-icon>
        <span style="margin-left: 6px;">Añadir coche</span>
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<!-- CONTENIDO PRINCIPAL ----------------------------------------- -->
<ion-content color="light">

  <ion-list lines="none">

    <!-- CARD DE CADA COCHE -->
    <ion-card *ngFor="let coche of coches" class="car-card">

      <div class="car-container">

        <!-- FOTO DEL COCHE -->
        <img
          [src]="coche.foto ? 'http://localhost:8080/uploads/' + coche.foto : 'assets/img/default.jpg'"
          alt="Foto coche"
          class="car-image"
        />

        <!-- INFO DEL COCHE -->
        <div class="car-info">

          <h2 class="car-title">{{ coche.marca }} {{ coche.modelo }}</h2>

          <p class="car-detail">
            <strong>Año:</strong> {{ coche.anio }}
          </p>

          <p class="car-detail">
            <strong>Matrícula:</strong> {{ coche.matricula }}
          </p>

          <p class="car-price">
            {{ coche.precio_dia }} €/día
          </p>

        </div>

        <!-- BOTÓN ELIMINAR -->
        <ion-button
          color="danger"
          fill="solid"
          class="delete-btn"
          (click)="eliminar(coche.id)"
        >
          Eliminar
        </ion-button>

        <!-- BOTÓN EDITAR -->
        <ion-button
          color="medium"
          fill="solid"
          class="edit-btn"
          (click)="abrirModal(coche)"
        >
          Editar
        </ion-button>

      </div>

    </ion-card>

  </ion-list>

</ion-content>

<!-- MODAL CREAR / EDITAR COCHE -------------------------------------------- -->
<ion-modal [isOpen]="modalAbierto">
  <ng-template>

    <!-- CABECERA DEL MODAL -->
    <ion-header>
      <ion-toolbar color="primary">

        <ion-title>{{ editando ? 'Editar coche' : 'Añadir coche' }}</ion-title>

        <ion-buttons slot="end">
          <ion-button (click)="cerrarModal()">Cerrar</ion-button>
        </ion-buttons>

      </ion-toolbar>
    </ion-header>

    <!-- CUERPO DEL MODAL ------------------------------------------------ -->
    <ion-content class="ion-padding">

      <form enctype="multipart/form-data">

        <ion-list>

          <!-- Marca -->
          <ion-item>
            <ion-label position="stacked">Marca</ion-label>
            <ion-input [(ngModel)]="form.marca" name="marca"></ion-input>
          </ion-item>

          <!-- Modelo -->
          <ion-item>
            <ion-label position="stacked">Modelo</ion-label>
            <ion-input [(ngModel)]="form.modelo" name="modelo"></ion-input>
          </ion-item>

          <!-- Matrícula -->
          <ion-item>
            <ion-label position="stacked">Matrícula</ion-label>
            <ion-input [(ngModel)]="form.matricula" name="matricula"></ion-input>
          </ion-item>

          <!-- Año -->
          <ion-item>
            <ion-label position="stacked">Año</ion-label>
            <ion-input type="number" [(ngModel)]="form.anio" name="anio"></ion-input>
          </ion-item>

          <!-- Precio por día -->
          <ion-item>
            <ion-label position="stacked">Precio/día</ion-label>
            <ion-input type="number" [(ngModel)]="form.precio_dia" name="precio_dia"></ion-input>
          </ion-item>

          <!-- Disponible -->
          <ion-item>
            <ion-label>Disponible</ion-label>
            <ion-toggle [(ngModel)]="form.disponible" name="disponible"></ion-toggle>
          </ion-item>

        </ion-list>

        <!-- FOTO (fuera del ion-item) -->
        <div style="margin-top: 16px; margin-bottom: 16px;">
          <label style="font-size: 14px; font-weight: 600;">Foto</label>
          <input 
            type="file" 
            name="foto" 
            accept="image/*" 
            (change)="seleccionarFoto($event)"
            style="margin-top: 6px;"
          >
        </div>

        <!-- BOTÓN GUARDAR -->
        <ion-button expand="block" color="success" (click)="guardar()">
          {{ editando ? 'Guardar cambios' : 'Crear coche' }}
        </ion-button>

      </form>
      <!-- FIN DEL FORMULARIO -->

    </ion-content>

  </ng-template>
</ion-modal>

